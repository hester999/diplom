events {}

http {
    include mime.types;
    default_type application/octet-stream;

    server {
        listen 80;

        # ✅ Главная страница
        location / {
            root /app/templates;
            index index.html;
        }

        # ✅ Проксирование API для SQL-инъекций
        location /sql-injection/ {
            proxy_pass http://sql-injection:5000/sql-injection/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # ✅ Раздача статики для SQL-инъекций
        location /sql-injection/static/ {
            alias /app/templates/SQL/;
            expires max;
        }

        # ✅ Проксирование API для XSS
        location /xss/ {
            proxy_pass http://xss_service:5000/xss/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # ✅ Раздача статики для XSS
        location /xss/static/ {
            alias /app/templates/xss/;
            expires max;
        }


        # ✅ Проксирование API для file-upload
         location /file-upload/ {
            proxy_pass http://file_upload_service:5000/file-upload/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            client_max_body_size 1000M;
        }

        # ✅ Раздача статики для file-upload
        location /file-upload/static/ {
            alias /app/templates/file-upload/;
            expires max;
        }





        # ✅ Проксирование API для CSRF
        location /csrf/ {
           proxy_pass http://csrf_service:5000/csrf/;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
        }

           location /csrf/static/ {
            alias /app/templates/csrf/;
            expires max;
        }

        # ✅ Проксирование API для атакера
        location /attacker/ {
            proxy_pass http://attacker:5000/attacker/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # ✅ Раздача статики для атакера
        location /attacker/static/ {
            alias /app/templates/attacker/;
            expires max;
        }

        # ✅ Глобальная раздача статических файлов (CSS, JS, изображения)
        location ~* \.(?:css|js|ico|png|jpg|jpeg|gif|svg)$ {
            root /app/templates;
            expires 6M;
            access_log off;
            add_header Cache-Control "public, max-age=31536000, immutable";
        }
    }
}
